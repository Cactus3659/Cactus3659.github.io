<!DOCTYPE HTML>
<html>
    <head>
        <style> body { margin: 0; } </style>
        <meta charset="UTF-8">
        <link rel="stylesheet" type="text/css" href="./style.css">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Racing Game - Cactus35</title>
        <style>
            #gameCanvas {
                display: block;
                margin: 20px auto;
                background: #1a1a1a;
                border: 3px solid #ffdd48;
            }
            .game-container {
                text-align: center;
                margin-top: 20px;
            }
            .controls {
                margin: 20px auto;
                font-size: 18px;
            }
            .score {
                font-size: 24px;
                font-weight: bold;
                color: #ffdd48;
                margin: 10px;
            }
            .game-over {
                font-size: 32px;
                font-weight: bold;
                color: #ff4444;
                display: none;
            }
            .game-paused {
                font-size: 32px;
                font-weight: bold;
                color: #ffdd48;
                display: none;
            }
            .stats {
                font-size: 18px;
                color: #ffffff;
                margin: 5px;
            }
        </style>
    </head>
    <body>
        <div class="header">
            <b><a href="../index.html">Home</a> | <a href="../projects.html">Projects</a></b>
            <br>
            <h1>Racing Game</h1>
        </div>
        
        <div class="game-container">
            <div class="score">Score: <span id="score">0</span> | High Score: <span id="highScore">0</span></div>
            <div class="stats">Speed: <span id="speed">2.0</span> | Cars Dodged: <span id="carsDodged">0</span></div>
            <canvas id="gameCanvas" width="400" height="600"></canvas>
            <div class="controls">
                <b>Controls: W/A/S/D or Arrow Keys to move | P to pause | R to restart</b>
            </div>
            <div class="game-paused" id="gamePaused">
                <p>PAUSED</p>
                <p>Press P to resume</p>
            </div>
            <div class="game-over" id="gameOver">
                <p>GAME OVER!</p>
                <p>Press R to restart</p>
            </div>
        </div>

        <script>
            const canvas = document.getElementById('gameCanvas');
            const ctx = canvas.getContext('2d');
            const scoreElement = document.getElementById('score');
            const highScoreElement = document.getElementById('highScore');
            const speedElement = document.getElementById('speed');
            const carsDodgedElement = document.getElementById('carsDodged');
            const gameOverElement = document.getElementById('gameOver');
            const gamePausedElement = document.getElementById('gamePaused');

            // Game state
            let gameRunning = true;
            let gamePaused = false;
            let score = 0;
            let carsDodged = 0;
            let speed = 2;
            let highScore = localStorage.getItem('racingGameHighScore') || 0;
            highScoreElement.textContent = highScore;

            // Player car
            const player = {
                x: canvas.width / 2 - 20,
                y: canvas.height - 100,
                width: 40,
                height: 60,
                speed: 5,
                color: '#ffdd48'
            };

            // Keys pressed
            const keys = {};

            // Obstacles (enemy cars)
            const obstacles = [];
            const obstacleColors = ['#ff4444', '#4444ff', '#44ff44', '#ff44ff'];

            // Road lines
            const roadLines = [];
            for (let i = 0; i < 10; i++) {
                roadLines.push({
                    x: canvas.width / 2 - 2,
                    y: i * 80,
                    width: 4,
                    height: 40
                });
            }

            // Event listeners for keyboard
            document.addEventListener('keydown', (e) => {
                keys[e.key.toLowerCase()] = true;
                
                // Restart game
                if (e.key.toLowerCase() === 'r' && !gameRunning) {
                    resetGame();
                }
                
                // Pause/unpause game
                if (e.key.toLowerCase() === 'p' && gameRunning) {
                    togglePause();
                }
            });

            document.addEventListener('keyup', (e) => {
                keys[e.key.toLowerCase()] = false;
            });

            // Create obstacle
            function createObstacle() {
                const lanes = [50, 150, 250, 330];
                const lane = lanes[Math.floor(Math.random() * lanes.length)];
                obstacles.push({
                    x: lane,
                    y: -80,
                    width: 40,
                    height: 60,
                    color: obstacleColors[Math.floor(Math.random() * obstacleColors.length)]
                });
            }

            // Update game state
            function update() {
                if (!gameRunning || gamePaused) return;

                // Move player based on WASD
                if (keys['w'] || keys['arrowup']) {
                    player.y -= player.speed;
                }
                if (keys['s'] || keys['arrowdown']) {
                    player.y += player.speed;
                }
                if (keys['a'] || keys['arrowleft']) {
                    player.x -= player.speed;
                }
                if (keys['d'] || keys['arrowright']) {
                    player.x += player.speed;
                }

                // Keep player in bounds
                if (player.x < 20) player.x = 20;
                if (player.x > canvas.width - player.width - 20) player.x = canvas.width - player.width - 20;
                if (player.y < 0) player.y = 0;
                if (player.y > canvas.height - player.height) player.y = canvas.height - player.height;

                // Update road lines
                roadLines.forEach(line => {
                    line.y += speed;
                    if (line.y > canvas.height) {
                        line.y = -40;
                    }
                });

                // Update obstacles
                obstacles.forEach((obstacle, index) => {
                    obstacle.y += speed;

                    // Remove obstacles that are off screen
                    if (obstacle.y > canvas.height) {
                        obstacles.splice(index, 1);
                        score += 10;
                        carsDodged += 1;
                        scoreElement.textContent = score;
                        carsDodgedElement.textContent = carsDodged;
                        
                        // Update high score
                        if (score > highScore) {
                            highScore = score;
                            highScoreElement.textContent = highScore;
                            localStorage.setItem('racingGameHighScore', highScore);
                        }
                        
                        // Increase difficulty gradually
                        if (carsDodged % 10 === 0 && speed < 8) {
                            speed += 0.3;
                            speedElement.textContent = speed.toFixed(1);
                        }
                    }

                    // Check collision
                    if (checkCollision(player, obstacle)) {
                        gameOver();
                    }
                });

                // Spawn new obstacles (adjusted for better gameplay)
                if (Math.random() < 0.015 + (speed * 0.002)) {
                    createObstacle();
                }
            }

            // Check collision between two rectangles
            function checkCollision(rect1, rect2) {
                return rect1.x < rect2.x + rect2.width &&
                       rect1.x + rect1.width > rect2.x &&
                       rect1.y < rect2.y + rect2.height &&
                       rect1.y + rect1.height > rect2.y;
            }

            // Draw everything
            function draw() {
                // Clear canvas
                ctx.fillStyle = '#2a2a2a';
                ctx.fillRect(0, 0, canvas.width, canvas.height);

                // Draw road
                ctx.fillStyle = '#3a3a3a';
                ctx.fillRect(20, 0, canvas.width - 40, canvas.height);

                // Draw road lines
                ctx.fillStyle = '#ffffff';
                roadLines.forEach(line => {
                    ctx.fillRect(line.x, line.y, line.width, line.height);
                });

                // Draw player car
                ctx.fillStyle = player.color;
                ctx.fillRect(player.x, player.y, player.width, player.height);
                
                // Draw car details
                ctx.fillStyle = '#1a1a1a';
                ctx.fillRect(player.x + 5, player.y + 10, 10, 15);
                ctx.fillRect(player.x + 25, player.y + 10, 10, 15);
                ctx.fillRect(player.x + 5, player.y + 35, 10, 15);
                ctx.fillRect(player.x + 25, player.y + 35, 10, 15);

                // Draw obstacles
                obstacles.forEach(obstacle => {
                    ctx.fillStyle = obstacle.color;
                    ctx.fillRect(obstacle.x, obstacle.y, obstacle.width, obstacle.height);
                    
                    // Draw obstacle details
                    ctx.fillStyle = '#1a1a1a';
                    ctx.fillRect(obstacle.x + 5, obstacle.y + 10, 10, 15);
                    ctx.fillRect(obstacle.x + 25, obstacle.y + 10, 10, 15);
                    ctx.fillRect(obstacle.x + 5, obstacle.y + 35, 10, 15);
                    ctx.fillRect(obstacle.x + 25, obstacle.y + 35, 10, 15);
                });
            }

            // Game over
            function gameOver() {
                gameRunning = false;
                gameOverElement.style.display = 'block';
            }

            // Toggle pause
            function togglePause() {
                gamePaused = !gamePaused;
                if (gamePaused) {
                    gamePausedElement.style.display = 'block';
                } else {
                    gamePausedElement.style.display = 'none';
                }
            }

            // Reset game
            function resetGame() {
                gameRunning = true;
                gamePaused = false;
                score = 0;
                carsDodged = 0;
                speed = 2;
                scoreElement.textContent = score;
                carsDodgedElement.textContent = carsDodged;
                speedElement.textContent = speed.toFixed(1);
                gameOverElement.style.display = 'none';
                gamePausedElement.style.display = 'none';
                player.x = canvas.width / 2 - 20;
                player.y = canvas.height - 100;
                obstacles.length = 0;
                
                // Reset road lines
                roadLines.forEach((line, i) => {
                    line.y = i * 80;
                });
            }

            // Game loop
            function gameLoop() {
                update();
                draw();
                requestAnimationFrame(gameLoop);
            }

            // Start the game
            gameLoop();
        </script>
    </body>
</html>
